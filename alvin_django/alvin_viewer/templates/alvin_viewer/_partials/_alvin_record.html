{% load i18n static metadata_wrangler %}

{% block title %}
<title>Alvin - {{ metadata|alvin_title:metadata.record_type }}</title>
{% endblock %}

<!-- Metadata -->
<div class="flex flex-col w-full">
    <div x-show="activeTab === 'overview' || activeTab === 'all_metadata'" x-cloak>
        {% for title in metadata.variant_titles %}
            {% include "./_metadata_row.html" with label=title.label value=title|alvin_record_title attribute=title.type %}
        {% endfor %}
    </div>
    {% for agent in metadata.agents %}
        {% url 'alvin_viewer' agent.type agent.id as agent_url %}
        {% include "./_metadata_row.html" with label=agent.label url=agent_url value=agent.name.names|agent_name attribute=agent.role|role_join %}
    {% endfor %}
    {% for place in metadata.origin_places %}
        {% url 'alvin_viewer' 'alvin-place' place.id as place_url %}
        {% include "./_metadata_row.html" with label=place.label url=place_url value=place.name|alvin_place_name extra_value=place|origin_countries %}
    {% endfor %}
    <div x-show="activeTab === 'overview' || activeTab === 'all_metadata'" x-cloak>
        {% include "./_metadata_row.html" with label=metadata.origin_date.label value=metadata.origin_date.dates|dates_join %}
        {% include "./_metadata_row.html" with label=metadata.display_date.label value=metadata.display_date.text %}
    </div>
    <div x-show="activeTab == 'all_metadata'" x-cloak>
        {% include "./_metadata_row.html" with label=metadata.edition_statement.label value=metadata.edition_statement.text %}
        {% include "./_metadata_row.html" with label=metadata.publications.label value=metadata.publications.texts|join:"<br>" %}
        {% for date in metadata.date_other %}
            {% include "./_metadata_row.html" with label=date.dates.label value=date.dates|dates_join  %}
        {% endfor %}
        {% include "./_metadata_row.html" with label=metadata.languages.label value=metadata.languages.items|join:"<br>"|safe %}
        {% include "./_metadata_row.html" with label=metadata.description_languages.label value=metadata.description_languages.items|join:"<br>"|safe %}
    </div>
    <div x-show="activeTab == 'all_metadata' || activeTab == 'related'" x-cloak>
        {% url 'alvin_viewer' 'alvin-location' metadata.location.id as location_url %}
        {% include "./_metadata_row.html" with label=metadata.location.label url=location_url value=metadata.location.name|agent_name %}
    </div>
    <div x-show="activeTab == 'all_metadata'" x-cloak>
        {% include "./_metadata_row.html" with label=metadata.sublocation.label value=metadata.sublocation.text %}
        {% include "./_metadata_row.html" with label=metadata.shelf_mark.label value=metadata.shelf_mark.text %}
        {% include "./_metadata_row.html" with label=metadata.former_shelf_mark.label value=metadata.former_shelf_mark.texts|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.subcollection.label value=metadata.subcollection.items|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.physcial_location_note.label extra_label="Fysisk placering" value=metadata.note|linebreaksbr %}
        {% include "./_metadata_row.html" with label=metadata.base_material.label value=metadata.base_material.items|join:", " %}
        {% include "./_metadata_row.html" with label=metadata.applied_material.label value=metadata.applied_material.items|join:", " %}
        {% include "./_metadata_row.html" with label=metadata.extent.label value=metadata.extent.text|linebreaksbr %}
        {% for dimension in metadata.dimensions %}
            {% include "./_metadata_row.html" with label=dimension|label_join:"scope" value=dimension|dimensions_join %}
        {% endfor %}
        {% include "./_metadata_row.html" with label=metadata.measure.label value=metadata.measure|measure_join %}
        {% for note in metadata.physical_description_notes.texts %}
            {% include "./_metadata_row.html" with label=note.type value=note.text|linebreaksbr %}
        {% endfor %}
        {% for note in metadata.notes.texts %}
            {% include "./_metadata_row.html" with label=note.type value=note.text|linebreaksbr %}
        {% endfor %}
        {% include "./_metadata_row.html" with label=metadata.summary.label value=metadata.summary.text|linebreaksbr %}
        {% include "./_metadata_row.html" with label=metadata.transcription.label value=metadata.transcription.text|linebreaksbr %}
        {% include "./_metadata_row.html" with label=metadata.table_of_contents.label value=metadata.table_of_contents.text|linebreaksbr %}
        {% include "./_metadata_row.html" with label=metadata.literature.label value=metadata.literature.text|linebreaksbr %}
        {% include "./_metadata_row.html" with label=metadata.access_policy.label value=metadata.access_policy.text|linebreaksbr %}
        {% for subject in metadata.subjects %}
            {% include "./_metadata_row.html" with label="Ämnesord" extra_label=subject.type value=subject|subjects_join %}
        {% endfor %}
    </div>
    <div x-show="activeTab == 'all_metadata' || activeTab == 'related'" x-cloak>
        {% include "./_record_type_links.html" with label=metadata.subject_person.label link_type="alvin-person" record_type_links=metadata.subject_person %}
        {% include "./_record_type_links.html" with label=metadata.subject_organisation.label link_type="alvin-organisation" record_type_links=metadata.subject_organisation %}
        {% include "./_record_type_links.html" with label=metadata.subject_place.label link_type="alvin-place" record_type_links=metadata.subject_place %}
    </div>
    <div x-show="activeTab == 'all_metadata'" x-cloak>
        {% include "./_metadata_row.html" with label=metadata.genre_form.label value=metadata.genre_form.items|join:"<br>"|safe %}
        {% for classification in metadata.classifications %}
            {% include "./_metadata_row.html" with label="Klassifikation" extra_label=classification.type value=classification.classification %}
        {% endfor %}
        {% for identifier in metadata.identifiers %}
            {% include "./_metadata_row.html" with label=identifier.label extra_label=identifier.type value=identifier.identifier %}
        {% endfor %}
    </div>
    <div x-show="activeTab == 'all_metadata' || activeTab == 'related'" x-cloak>
        {% include "alvin_viewer/_partials/_record_type_links.html" with label=metadata.related_records.label link_type="alvin-record" record_type_links=metadata.related_records %}
        {% include "./_record_type_links.html" with label=metadata.work.label link_type="alvin-work" record_type_links=metadata.work %}
        {% for electronic_locator in metadata.electronic_locators %}
            {% include "./_metadata_row.html" with label="Extern länk" url=electronic_locator.url value=electronic_locator.display_label %}
        {% endfor %}
    </div>
    <div x-show="activeTab == 'all_metadata'" x-cloak>
        {% include "./_metadata_row.html" with label=metadata.level.label value=metadata.level.item %}
        {% include "./_metadata_row.html" with label=metadata.shelf_metres.label value=metadata.shelf_metres.text %}
        {% include "./_metadata_row.html" with label=metadata.archival_units.label value=metadata.archival_units.text %}
        {% include "./_metadata_row.html" with label=metadata.other_findaid.label value=metadata.other_findaid.texts|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.weeding.label value=metadata.weeding.texts|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.related_material.label value=metadata.related_material.texts|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.arrangement.label value=metadata.arrangement.texts|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.accruals.label value=metadata.accruals.texts|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.locus.label value=metadata.locus.text %}
        {% include "./_metadata_row.html" with label=metadata.incipit.label value=metadata.incipit.text %}
        {% include "./_metadata_row.html" with label=metadata.explicit.label value=metadata.explicit.text %}
        {% include "./_metadata_row.html" with label=metadata.rubric.label value=metadata.rubric.text %}
        {% include "./_metadata_row.html" with label=metadata.final_rubric.label value=metadata.final_rubric.text %}
        {% include "./_metadata_row.html" with label=metadata.music_key.label value=metadata.music_key.items|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.music_key_other.label value=metadata.music_key_other.text %}
        {% include "./_metadata_row.html" with label=metadata.music_medium.label value=metadata.music_medium.items|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.music_medium_other.label value=metadata.music_medium_other.text %}
        {% include "./_metadata_row.html" with label=metadata.music_notation.label value=metadata.music_notation.items|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.scale.label value=metadata.scale.text %}
        {% include "./_metadata_row.html" with label=metadata.projection.label value=metadata.projection.text %}
        {% include "./_metadata_row.html" with label=metadata.coordinates.label value=metadata.coordinates.text %}
        {% include "./_metadata_row.html" with label=metadata.appraisal.label value=metadata.appraisal|appraisal_join %}
        {% include "./_metadata_row.html" with label=metadata.edge.label value=metadata.edge|item_description_join %}
        {% include "./_metadata_row.html" with label=metadata.axis.label value=metadata.axis.item.item %}
        {% include "./_metadata_row.html" with label=metadata.conservation_state.label value=metadata.conservation_state.items|join:"<br>" %}
        {% include "./_metadata_row.html" with label=metadata.obverse|label_join:"description" value=metadata.obverse.description.text %}
        {% include "./_metadata_row.html" with label=metadata.obverse|label_join:"legend" value=metadata.obverse.legend.text %}
        {% include "./_metadata_row.html" with label=metadata.reverse|label_join:"description" value=metadata.reverse.description.text %}
        {% include "./_metadata_row.html" with label=metadata.reverse|label_join:"legend" value=metadata.reverse.legend.text %}
        {% include "./_metadata_row.html" with label=metadata.countermark.label value=metadata.countermark.texts|join:"<br>" %}
        {% translate 'Post skapad' as ts_created %}
        {% include "./_metadata_row.html" with label=ts_created value=metadata.created %}
        {% translate 'Senast uppdaterad' as ts_updated %}
        {% include "./_metadata_row.html" with label=ts_updated value=metadata.last_updated %}
        {% include "./_metadata_row.html" with label='Källdata' value=metadata.source_xml %}
    </div>
    <div x-show="activeTab === 'overview' || activeTab === 'all_metadata'" x-cloak>
        {% include "./_metadata_row.html" with label="Id" value=metadata.id %}
    </div>
    {% if metadata.components %}
    <div x-show="activeTab == 'overview' || activeTab == 'all_metadata' || activeTab == 'inventory'" x-cloak>
        <h1 class="text-2xl mt-6">
            {% if metadata.type_of_resource.code == 'col' %}
                {% translate 'Arkivförteckning' %}
            {% else %}
                {% translate 'Innehållsbeskrivning' %}
            {% endif %}
        </h1>
        {% include "alvin_viewer/_partials/_components.html" with components=metadata.components only %}
    </div>
    <div x-show="activeTab === 'related'" x-cloak>
        <!-- Related records from components -->
    </div>
    {% endif %}
</div>

<!-- Map -->
{% if metadata.latitude and metadata.longitude %}
    <aside class="w-full h-[600px] max-sm:h-[400px] z-0 border-alvin-orange border-4 mb-10" id="map" x-show="activeTab != 'related'" x-cloak></aside>
    {% block jsbody %}
        <script defer src="{% static 'js/map.js' %}" 
            data-latitude="{{ metadata.latitude }}"
            data-longitude="{{ metadata.longitude }}">
        </script>
    {% endblock %}
{% endif %}

