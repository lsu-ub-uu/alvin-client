{% load i18n static metadata_wrangler %}

{% block title %}
<title>Alvin - {{ metadata|alvin_title:metadata.record_type }}</title>
{% endblock %}

<!-- Metadata -->
<div class="flex flex-col">
    {{metadata}}
    <div x-show="activeTab != 'related' && activeTab != 'inventory'">
        {% for title in metadata.variant_titles %}
            {% include "./_metadata_row.html" with label="Alternativ titel" value=title|alvin_work_name attribute=title.type %}
        {% endfor %}
        {% for agent in metadata.agents %}
            {% url 'alvin_viewer' agent.type agent.id as agent_url %}
            {% include "./_metadata_row.html" with label=agent.label url=agent_url value=agent.name|agent_name attribute=agent.role|role_list %}
        {% endfor %}
        {% for place in metadata.origin_places %}
            {% url 'alvin_viewer' 'alvin-place' place.id as place_url %}
            {% include "./_metadata_row.html" with label="Ursprungsplats" url=place_url value=place_url extra_value=place|origin_countries %}
        {% endfor %}
        {% include "./_metadata_row.html" with label="Startdatum" value=metadata.start_date %}
        {% include "./_metadata_row.html" with label="Slutdatum" value=metadata.end_date %}
        {% include "./_metadata_row.html" with label=metadata.display_date.label value=metadata.display_date.text %}
    
        <div class="flex flex-col" x-show="activeTab == 'all_metadata'" x-cloak>
            {% include "./_metadata_row.html" with label=metadata.edition_statement.label value=metadata.edition_statement.text %}
            {% include "./_metadata_row.html" with label=metadata.publications.label value=metadata.publications.texts|join:"<br>" %}
            {% for date in metadata.date_other %}
                {% include "./_metadata_row.html" with label="Övrigt datum" value=date|date_other_join attribute=date.type  %}
            {% endfor %}
            {% include "./_metadata_row.html" with label=metadata.languages.label value=metadata.languages.items|join:"<br>"|safe %}
            {% include "./_metadata_row.html" with label=metadata.description_languages.label value=metadata.description_languages.items|join:"<br>"|safe %}
            {% url 'alvin_viewer' 'alvin-location' metadata.physical_location.held_by.id as held_by_url %}
            {% include "./_metadata_row.html" with label=metadata.physical_location.held_by.label value=metadata.physical_location.held_by.name|agent_name url=held_by_url %}
            {% include "./_metadata_row.html" with label=metadata.physical_location.sublocation.label value=metadata.physical_location.sublocation.text %}
            {% include "./_metadata_row.html" with label=metadata.physical_location.shelf_mark.label value=metadata.physical_location.shelf_mark.text %}
            {% include "./_metadata_row.html" with label=metadata.physical_location.former_shelf_mark.label value=metadata.physical_location.former_shelf_mark.texts|join:"<br>" %}
            {% include "./_metadata_row.html" with label=metadata.physical_location.subcollection.label value=metadata.physical_location.subcollection.items|join:"<br>" %}
            {% include "./_metadata_row.html" with label=metadata.physical_location.note.label extra_label="Fysisk placering" value=metadata.physical_location.note|default:""|linebreaksbr %}
            {% include "./_metadata_row.html" with label=metadata.base_material.label value=metadata.base_material.items|join:", " %}
            {% include "./_metadata_row.html" with label=metadata.applied_material.label value=metadata.applied_material.items|join:", " %}
            {% include "./_metadata_row.html" with label=metadata.extent.label value=metadata.extent.text|default:""|linebreaksbr %}
            {% for dimension in metadata.dimensions %}
                {% include "./_metadata_row.html" with label="Mått" extra_label=dimension.scope value=dimension|dimensions_join attribute=dimension.unit %}
            {% endfor %}
            {% include "./_metadata_row.html" with label=metadata.physical_description_notes.label value=metadata.physical_description_notes.texts|join:"<br>"|default:""|linebreaksbr %}
            {% for note in metadata.notes.texts %}
                {% include "./_metadata_row.html" with label=note.type value=note.text|default:""|linebreaksbr %}
            {% endfor %}
            {% include "./_metadata_row.html" with label=metadata.summary.label value=metadata.summary.text|default:""|linebreaksbr %}
            {% include "./_metadata_row.html" with label=metadata.transcription.label value=metadata.transcription.text|default:""|linebreaksbr %}
            {% include "./_metadata_row.html" with label=metadata.table_of_contents.label value=metadata.table_of_contents.text|default:""|linebreaksbr %}
            {% include "./_metadata_row.html" with label=metadata.literature.label value=metadata.literature.text|default:""|linebreaksbr %}
            {% include "./_metadata_row.html" with label=metadata.access_policy.label value=metadata.access_policy.text|default:""|linebreaksbr %}
            {% for subject in metadata.subjects %}
                {% include "./_metadata_row.html" with label="Ämnesord" extra_label=subject.type value=subject|subjects_join %}
            {% endfor %}
            {% include "./_record_type_links.html" with label="Ämne, person" link_type="alvin-person" record_type_links=metadata.subject_person %}
            {% include "./_record_type_links.html" with label="Ämne, organisation" link_type="alvin-organisation" record_type_links=metadata.subject_organisation %}
            {% include "./_record_type_links.html" with label="Ämne, plats" link_type="alvin-place" record_type_links=metadata.subject_place %}
            {% include "./_metadata_row.html" with label=metadata.genre_form.label value=metadata.genre_form.items|join:"<br>"|safe %}
            {% for classification in metadata.classifications %}
                {% include "./_metadata_row.html" with label="Klassifikation" extra_label=classification.type value=classification.classification %}
            {% endfor %}
            {% for identifier in metadata.identifiers %}
                {% include "./_metadata_row.html" with label="Identifikator" extra_label=identifier.type value=identifier.identifier %}
            {% endfor %}
            {% include "./_record_type_links.html" with label="Relaterade poster" link_type="alvin-record" record_type_links=metadata.related_records %}
            {% for electronic_locator in metadata.electronic_locators %}
                {% include "./_metadata_row.html" with label="Extern länk" url=electronic_locator.url value=electronic_locator.display_label %}
            {% endfor %}
            {% if metadata.longitude and metadata.latitude %}
                {% include "./_metadata_row.html" with label="Longitud" value=metadata.longitude %}
                {% include "./_metadata_row.html" with label="Latitud" value=metadata.latitude %}
            {% endif %}
            {% include "./_metadata_row.html" with label="Incipit" value=metadata.incipit %}
            {% include "./_metadata_row.html" with label="Post skapad" value=metadata.created %}
            {% include "./_metadata_row.html" with label="Senast uppdaterad" value=metadata.last_updated %}
            {% include "./_metadata_row.html" with label='Källdata' value=metadata.source_xml %}
        </div>
        {% include "./_metadata_row.html" with label="Id" value=metadata.id %}
        {% if metadata.components %}
            <div>
                <h1 class="text-2xl mt-6">
                    {% translate 'Arkivförteckning' %}
                </h1>
                <div class="flex flex-col">
                    {% include "alvin_viewer/_partials/_components.html" with components=metadata.components only %}
                </div>
            </div>
        {% endif %}
    </div>

    <div class="flex flex-col" x-show="activeTab == 'related'" x-cloak>

    </div>

    <!-- Components -->
    {% if metadata.components %}
        <div class="flex flex-col" x-show="activeTab == 'inventory'" x-cloak>
            {% include "alvin_viewer/_partials/_components.html" with components=metadata.components only %}
        </div>
    {% endif %}

</div>

<!-- Map -->
{% if metadata.latitude and metadata.longitude %}
    <aside class="w-full h-[600px] max-sm:h-[400px] z-0 border-alvin-orange border-4 mb-10" id="map" x-show="activeTab != 'related'" x-cloak></aside>

    {% block jsbody %}
        <script defer src="{% static 'js/map.js' %}" 
            data-latitude="{{ metadata.latitude }}"
            data-longitude="{{ metadata.longitude }}">
        </script>
    {% endblock %}
{% endif %}

